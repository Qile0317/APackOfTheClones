<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Integrates a cell ranger T cell library into a Seurat object with a UMAP
reduction. Then gets sizes of unique clones and utilizes a circle-packing
algorithm to pack circles representing individual clones in approximately
the same UMAP coordinates and clusters into a ggplot object."><title>Visualize T cell clonal expansion with a ball-packing plot. — clonal_expansion_plot • APackOfTheClones</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Visualize T cell clonal expansion with a ball-packing plot. — clonal_expansion_plot"><meta property="og:description" content="Integrates a cell ranger T cell library into a Seurat object with a UMAP
reduction. Then gets sizes of unique clones and utilizes a circle-packing
algorithm to pack circles representing individual clones in approximately
the same UMAP coordinates and clusters into a ggplot object."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">APackOfTheClones</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Clonal_expansion_plotting.html">Clonal expansion plotting tutorial</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Visualize T cell clonal expansion with a ball-packing plot.</h1>
      
      <div class="d-none name"><code>clonal_expansion_plot.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Integrates a cell ranger T cell library into a Seurat object with a UMAP
reduction. Then gets sizes of unique clones and utilizes a circle-packing
algorithm to pack circles representing individual clones in approximately
the same UMAP coordinates and clusters into a ggplot object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">clonal_expansion_plot</span><span class="op">(</span></span>
<span>  <span class="va">seurat_obj</span>,</span>
<span>  tcr_df <span class="op">=</span> <span class="st">"seurat_obj_already_integrated"</span>,</span>
<span>  res <span class="op">=</span> <span class="fl">360</span>,</span>
<span>  clone_scale_factor <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  rad_scale_factor <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  ORDER <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  try_place <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  repulse <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  repulsion_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  repulsion_strength <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  max_repulsion_iter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  use_default_theme <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show_origin <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  retain_axis_scales <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  add_size_legend <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  legend_sizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  legend_position <span class="op">=</span> <span class="st">"top_left"</span>,</span>
<span>  legend_buffer <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  legend_color <span class="op">=</span> <span class="st">"#808080"</span>,</span>
<span>  legend_spacing <span class="op">=</span> <span class="fl">0.4</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>seurat_obj</dt>
<dd><p>Seurat object with at least a UMAP reduction. Can either already have been integrated with a T cell library via `integrate_tcr(seurat_obj, tcr_df)`, in which case the subsquent `tcr_df` argument can be left empty. Else, the object must be a regular seurat object and a T cell library must be inputted in the following `tcr_df` argument</p></dd>


<dt>tcr_df</dt>
<dd><p>If left empty, `seurat_obj` is assumed to be already integrated. Otherwise, should be a `data.frame` of the T cell library generated by 10X genomics' Cell Ranger. The dataframe has to at least have the `barcode` and `raw_clonotype_id` columns.</p></dd>


<dt>res</dt>
<dd><p>The number of points on the generated path per full circle. From plot viewers, if circles seem slightly too pixelated, it is highly recommended to first try to export the plot as an `.svg` before increasing `res`</p></dd>


<dt>clone_scale_factor</dt>
<dd><p>numeric. Decides how much to scale each circle. Usually should be kept at around 0.01 to somewhat maintain UMAP structure for large datasets. However, if the plot that is displayed is ever blank, first try increasing this value.</p></dd>


<dt>rad_scale_factor</dt>
<dd><p>numeric. indicates how much the radii of the clones should decrease to add a slight gap between all of them. Defaults to 1 but 0.85-0.95 values are recommended. Both `rad_scale_factor` and `clone_scale_factor` may need to be repeatedly readjusted</p></dd>


<dt>ORDER</dt>
<dd><p>logical. Decides if the largest clones should be at the cluster centroids</p></dd>


<dt>try_place</dt>
<dd><p>If `TRUE`, always minimizes distance from a newly placed circle to the origin</p></dd>


<dt>verbose</dt>
<dd><p>logical. Decides if visual cues print to the REPL of the packing progress</p></dd>


<dt>repulse</dt>
<dd><p>If `TRUE`, will attempt to push overlapping clusters away from each other.</p></dd>


<dt>repulsion_threshold</dt>
<dd><p>numeric. The radius that cluster overlap is acceptable</p></dd>


<dt>repulsion_strength</dt>
<dd><p>numeric. The smaller the value the less the clusters repulse each other</p></dd>


<dt>max_repulsion_iter</dt>
<dd><p>numeric. The number of repulsion iterations, note that increasing this value may occasionally even lead to worse looking plots as clusters may repulse eachother too much</p></dd>


<dt>use_default_theme</dt>
<dd><p>If `TRUE`, the resulting plot will have the same theme as the seurat UMAP. Else, the plot will simply have a blank background</p></dd>


<dt>show_origin</dt>
<dd><p>logical. If `TRUE`, only the centers of each circle will be plotted</p></dd>


<dt>retain_axis_scales</dt>
<dd><p>If `TRUE`, approximately maintains the axis scales of the original UMAP. However, it will only attempt to extend the axes and never shorten.</p></dd>


<dt>add_size_legend</dt>
<dd><p>If `TRUE`, adds a legend to the plot titled `"Clone sizes"` indicating the relative sizes of clones.</p></dd>


<dt>legend_sizes</dt>
<dd><p>numeric vector. Indicates the circle sizes to be displayed on the legend and defaults to `c(1, 5, 10)`.</p></dd>


<dt>legend_position</dt>
<dd><p>character. Can be set to either `"top_left"`, `"top_right"`, `"bottom_left"`, `"bottom_right"` and places the legend roughly in the corresponding position</p></dd>


<dt>legend_buffer</dt>
<dd><p>numeric. Indicates how much to "push" the legend towards the center of the plot from the selected corner. If negative, will push away</p></dd>


<dt>legend_color</dt>
<dd><p>character. Indicates the hex color of the circles displayed on the legend. Defaults to the hex code for gray</p></dd>


<dt>legend_spacing</dt>
<dd><p>numeric. Indicates the horizontal distance between each stacked circle on the size legend. Usually should be kept below 0.75 -ish depending on plot size.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns a ggplot2 object of the ball packing plot. Can be operated on like normal ggplot objects</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="integrate_tcr.html">integrate_tcr</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://qile0317.github.io/APackOfTheClones/" class="external-link">APackOfTheClones</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># run sc-RNAseq pipeline to produce a seurat_object</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">seurat_object</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://satijalab.org/seurat/reference/RunUMAP.html" class="external-link">RunUMAP</a></span><span class="op">(</span><span class="va">seurat_object</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">TCR_dataframe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"file_location/all_contig_annotations.csv"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># produce and show the ball-packing plot by integrating the data</span></span></span>
<span class="r-in"><span><span class="va">ball_pack_plot</span> <span class="op">&lt;-</span> <span class="fu">clonal_expansion_plot</span><span class="op">(</span><span class="va">seurat_object</span>, <span class="va">TCR_dataframe</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ball_pack_plot</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Qile Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

