<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Visualization of Clonal Expansion for Single Cell Immune Profiles • APackOfTheClones</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Visualization of Clonal Expansion for Single Cell Immune Profiles">
<meta name="description" content="Visualize clonal expansion via circle-packing. APackOfTheClones extends scRepertoire to produce a publication-ready visualization of clonal expansion at a single cell resolution, by representing expanded clones as differently sized circles. The method was originally implemented by Murray Christian and Ben Murrell in the following immunology study: Ma et al. (2021) &lt;doi:10.1126/sciimmunol.abg6356&gt;.">
<meta property="og:description" content="Visualize clonal expansion via circle-packing. APackOfTheClones extends scRepertoire to produce a publication-ready visualization of clonal expansion at a single cell resolution, by representing expanded clones as differently sized circles. The method was originally implemented by Murray Christian and Ben Murrell in the following immunology study: Ma et al. (2021) &lt;doi:10.1126/sciimmunol.abg6356&gt;.">
<meta property="og:image" content="https://qile0317.github.io/APackOfTheClones/logo.png">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=%7BG-TSDH5XEN3S%7D"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{G-TSDH5XEN3S}');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">APackOfTheClones</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="articles/APackOfTheClones.html">Get started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="articles/APackOfTheClones.html">APackOfTheClones Essentials</a></li>
    <li><a class="dropdown-item" href="articles/APackOfTheClones-runs.html">Storing and Fine-Tuning APackOfTheClones Runs</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-archive" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Archive</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-archive">
<li><a class="dropdown-item" href="articles/archive/v0-main.html">v0.1.x</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Qile0317/APackOfTheClones/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="apackoftheclones-">APackOfTheClones <a class="anchor" aria-label="anchor" href="#apackoftheclones-"></a>
</h1>
</div>
<!-- badges: start -->

<p><code>APackOfTheClones</code> is an R package that extends the bioconductor <code>scRepertoire</code> package to produce easily customizable “ball-packing” visualizations of the clonal expansion of T-cells/B-cells in a <code>Seurat</code> object, based on its receptor library and single cell RNA sequencing data (for example outputs from 10X genomics’ single-cell immune profiling).</p>
<p>The baseline concept was first implemented in a study Ma et al.<a href="#id_1">[1]</a> by Murray Christian and Ben Murrell (@Murrellb) for nasal polyp <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>T</mi><mi>H</mi></msub><annotation encoding="application/x-tex">T_{H}</annotation></semantics></math> cells. <code>APackOfTheClones</code> counts the clonotype frequencies for each seurat/umap cluster and produces a circle packing of the frequencies to intuitively represent clonal expansion. The packing for each cluster are then plotted with roughly the same coordinates as the original dimensional reduction and color. Below is an example of <code>APackOfTheClones</code> being used on an <a href="https://drive.google.com/file/d/1_YuRraDyg8UgF3oasjF0-jgPnwox-B24/view?usp=share_link" class="external-link">example seurat object for scRepertoire</a> with its corresponding VDJ library:</p>
<p><img src="reference/figures/example.png" width="100%" align="center" alt="An example APackOfTheClones plot"></p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p><code>APackOfTheClones</code> is registered on CRAN. To install the latest stable release, simply run the following</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"APackOfTheClones"</span><span class="op">)</span></span></code></pre></div>
<p>If there are any issues with the CRAN installation (for example, the package has been archived on CRAN for a brief period), try</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Qile0317/APackOfTheClones@cran"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, to download the latest semi-stable development edition, try</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Qile0317/APackOfTheClones"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>The package extends the functionality of <code>scRepertoire</code> <strong><em>v2</em></strong> by working with a seurat object’s corresponding T/B cell receptor library. To do this, read the <a href="borch.dev/uploads/screpertoire">scRepertoire vignette</a>. Briefly, an scTCR-seq/scBCR-seq experiment (e.g. from a 10X genomics single cell immune profiling run) should be processed with <code>scRepertoire::combineTCR</code> / <code>scRepertoire::combineBCR</code> first. Then, it should be integrated into the corresponding seurat object either with <code>scRepertoire::combineExpression</code>.</p>
<p>To quickly produce the visualization, the <code>vizAPOTC(your_combined_seurat_object)</code> should give a reasonable visualization. There is an example seurat object included in the package which can be used with <code>data("combined_pbmc")</code>. The following codechunk is an example of how it can be done:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://satijalab.org/seurat" class="external-link">Seurat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scRepertoire</span><span class="op">)</span> <span class="co"># ensure v2 is installed: devtools::install_github("ncborcherding/scRepertoire")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://qile0317.github.io/APackOfTheClones/">APackOfTheClones</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># integrate the contigs with scRepertoire example data - this is identical to "combined_pbmc"</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">combineExpression</span><span class="op">(</span></span>
<span>    input.data <span class="op">=</span> <span class="fu">combineTCR</span><span class="op">(</span></span>
<span>        input.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"mini_contig_list"</span>, package <span class="op">=</span> <span class="st">"scRepertoire"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P17B"</span>, <span class="st">"P17L"</span>, <span class="st">"P18B"</span>, <span class="st">"P18L"</span>, <span class="st">"P19B"</span>, <span class="st">"P19L"</span>, <span class="st">"P20B"</span>, <span class="st">"P20L"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sc.data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"scRep_example"</span>, package <span class="op">=</span> <span class="st">"scRepertoire"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># produce the ball-packing plot with the default parameters</span></span>
<span><span class="fu"><a href="reference/vizAPOTC.html">vizAPOTC</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># there are many parameters to adjust, but most importantly, one can filter for</span></span>
<span><span class="co"># subsets of the seurat object easily with keyword arguments corresponding to</span></span>
<span><span class="co"># columns in the meta.data dataframe in the seurat object. Here, we filter for</span></span>
<span><span class="co"># only the clones of the sample "P17" in a column named "orig.ident" that are only</span></span>
<span><span class="co"># in seurat clusters 1, 3, and 4.</span></span>
<span><span class="fu"><a href="reference/vizAPOTC.html">vizAPOTC</a></span><span class="op">(</span><span class="va">pbmc</span>, orig.ident <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P17B"</span>, <span class="st">"P17L"</span><span class="op">)</span>, seurat_clusters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For finer control of the visualization / other parameters, the data for a run can be stored and adjusted with <code>RunAPOTC</code> and <code>AdjustAPOTC</code>, then visualized with <code>APOTCPlot</code>, like so:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using the same seurat object as before, run and store associated data,</span></span>
<span><span class="co"># identifying it with a run id.</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span><span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"default_run_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the corresponding data with the run_id. If not provided, will use the latest run.</span></span>
<span><span class="fu"><a href="reference/APOTCPlot.html">APOTCPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"default_run_1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># adjust the sizes of the clones and move the 2nd cluster to (0, 0). Run id this time was</span></span>
<span><span class="co"># left empty for no particular reason, but it will use "default_run_1" since its the latest</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/AdjustAPOTC.html">AdjustAPOTC</a></span><span class="op">(</span></span>
<span>    <span class="va">pbmc</span>,</span>
<span>    new_clone_scale_factor <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>    relocate_cluster <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    relocation_coord <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># one can also do another run with different parameters and a different id.</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span><span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"run2"</span>, try_place <span class="op">=</span> <span class="cn">TRUE</span>, repulse <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot both runs side by side</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="reference/APOTCPlot.html">APOTCPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"default_run_1"</span><span class="op">)</span>, <span class="fu"><a href="reference/APOTCPlot.html">APOTCPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"run2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>Comprehensive documentation, vignettes, and a changelog is deployed at <a href="https://qile0317.github.io/APackOfTheClones/" class="uri">https://qile0317.github.io/APackOfTheClones/</a></p>
<p>There are also two vignettes within the package locally that should be read in order, and can be called with <code><a href="articles/APackOfTheClones.html">vignette("APackOfTheClones")</a></code> and <code><a href="articles/APackOfTheClones-runs.html">vignette("APackOfTheClones-runs")</a></code>.</p>
<p>All exported functions has function level documentation which can be called with <code>?function</code>.</p>
</div>
<div class="section level2">
<h2 id="contributing">Contributing<a class="anchor" aria-label="anchor" href="#contributing"></a>
</h2>
<p>Github pull requests from forked branches are more than welcome as it is mostly a solo-project at the moment. For major changes, please open an issue first to discuss what you would like to change. Please also make sure to update tests as appropriate.</p>
<p>An explanation of the algorithms will eventually be made publicly available in a either a pre-print or developer vignette.</p>
</div>
<div class="section level2">
<h2 id="upcoming-features">Upcoming features<a class="anchor" aria-label="anchor" href="#upcoming-features"></a>
</h2>
<p>One novel feature in the making is the ability to compute and visualize shared clonotypes on the ball packing plot.</p>
</div>
<div class="section level2">
<h2 id="contact">Contact<a class="anchor" aria-label="anchor" href="#contact"></a>
</h2>
<p>Qile Yang - <a href="mailto:qile.yang@berkeley.edu" class="email">qile.yang@berkeley.edu</a></p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p><a id="1">[1]</a> Ma, J., Tibbitt, C. A., Georén, S. K., Christian, M., Murrell, B., Cardell, L. O., Bachert, C., &amp; Coquet, J. M. (2021). Single-cell analysis pinpoints distinct populations of cytotoxic CD4+ T cells and an IL-10+CD109+ TH2 cell population in nasal polyps. Science immunology, 6(62), eabg6356. <a href="https://doi.org/10.1126/sciimmunol.abg6356" class="external-link uri">https://doi.org/10.1126/sciimmunol.abg6356</a></p>
</div>
<div class="section level2">
<h2 id="acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#acknowledgements"></a>
</h2>
<p>Thanks for Ben Murrell (@murrelb) at the Karolinska Institute for introducing the idea, implementing julia code, debug support, and giving suggestions. Thanks to Nick Borcherding (@ncborcherding) for providing more insights, suggestions, and promoting the package.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=APackOfTheClones" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/Qile0317/APackOfTheClones/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/Qile0317/APackOfTheClones/issues/" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing APackOfTheClones</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Qile Yang <br><small class="roles"> Maintainer, author, copyright holder </small>  </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://CRAN.R-project.org/package=APackOfTheClones" class="external-link"><img src="https://www.r-pkg.org/badges/version/APackOfTheClones" alt="CRAN status"></a></li>
<li><a href="https://www.r-pkg.org/pkg/APackOfTheClones" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/APackOfTheClones?color=brightgreen" alt="Downloads"></a></li>
<li><a href="https://github.com/Qile0317/APackOfTheClones/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/Qile0317/APackOfTheClones/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/Qile0317/APackOfTheClones?branch=main" class="external-link"><img src="https://codecov.io/gh/Qile0317/APackOfTheClones/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://qile0317.github.io/APackOfTheClones/"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="Documentation"></a></li>
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://github.com/Qile0317/APackOfTheClones/blob/unstable/LICENSE.md" class="external-link"><img src="https://img.shields.io/badge/license-MIT-green.svg" alt="MIT license"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Qile Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
