<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Working With Clonotypes Shared Across Clusters â€¢ APackOfTheClones</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working With Clonotypes Shared Across Clusters">
<meta name="robots" content="noindex">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-TSDH5XEN3S"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-TSDH5XEN3S');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">APackOfTheClones</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">1.2.4.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/APackOfTheClones-install.html">Install</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/APackOfTheClones.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/APackOfTheClones-runs.html">Storing and Fine-Tuning APackOfTheClones Runs</a></li>
    <li><a class="dropdown-item" href="../articles/APackOfTheClones-shared.html">Working With Clonotypes Shared Across Clusters</a></li>
    <li><a class="dropdown-item" href="../articles/APackOfTheClones-utils.html">Clonal Analysis Utilities in APackOfTheClones</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-archive" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Archive</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-archive">
<li><a class="dropdown-item" href="../articles/archive/v0-main.html">v0.1.x main vignette</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Qile0317/APackOfTheClones/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working With Clonotypes Shared Across Clusters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Qile0317/APackOfTheClones/blob/dev/vignettes/APackOfTheClones-shared.Rmd" class="external-link"><code>vignettes/APackOfTheClones-shared.Rmd</code></a></small>
      <div class="d-none name"><code>APackOfTheClones-shared.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A novel feature in this package is the ability to get, filter, and
visualize clonotypes that are common across seurat clusters. Potential
applications include the ability to quickly and intuitively gauge the
rough clonal heterogeneity of certain clusters. Note that in
scRepertoire, the <code>scRepertoire::clonalNetwork</code> function does
something similar for the original dimensional reductions using arrows,
though those display the aggregated degree of commonality between each
cluster.</p>
<p>Please read <code><a href="../articles/APackOfTheClones.html">vignette("APackOfTheClones")</a></code> and ideally
also <code><a href="../articles/APackOfTheClones-runs.html">vignette("APackOfTheClones-runs")</a></code> before reading this
vignette. One should then also see that although some of the
visualizations in this vignette were produced with the
<code><a href="../reference/vizAPOTC.html">vizAPOTC()</a></code> function, all visualizations can be replicated
with <code><a href="../reference/RunAPOTC.html">RunAPOTC()</a></code> and <code><a href="../reference/APOTCPlot.html">APOTCPlot()</a></code> that both
share parts of the arguments of <code><a href="../reference/vizAPOTC.html">vizAPOTC()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="getting-clonotypes-common-across-seurat-clusters">Getting Clonotypes Common Across Seurat Clusters<a class="anchor" aria-label="anchor" href="#getting-clonotypes-common-across-seurat-clusters"></a>
</h2>
<p><code><a href="../reference/getSharedClones.html">getSharedClones()</a></code> is a convenience function does so
while allowing the same seurat object subsetting arguments as seen in
<code><a href="../articles/APackOfTheClones.html">vignette("APackOfTheClones")</a></code>, and returns the clonotypes as
a named list where the <em>names</em> are the clonotypes and the
<em>elements</em> are numeric vectors where each value is one of the
clusters that the clonotype name at its index correspond to.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getSharedClones.html">getSharedClones</a></span><span class="op">(</span></span>
<span>    <span class="va">seurat_obj</span>,</span>
<span>    reduction_base <span class="op">=</span> <span class="st">"umap"</span>,</span>
<span>    clonecall <span class="op">=</span> <span class="st">"strict"</span>,</span>
<span>    <span class="va">...</span>,</span>
<span>    extra_filter <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    alt_ident <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    run_id <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    top <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    top_per_cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    intop <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    intop_per_cl <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    publicity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The last five optional arguments allow additional filtering of the
shared clonotypes. Most notably, <code>top</code> will filter the
resulting shared clonotypes to only those ranked in the <code>top</code>
frequencies, either as a proportion or number. More details can be found
in the function level documentation for the other arguments. They are
especially useful when an experiment has a really high number of
single-cells, and the only clonotypes of interest are the most expanded
ones.</p>
<p>Here is an example of the function in action, where a combined seurat
object is loaded with the variable name <code>pbmc</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/getSharedClones.html">getSharedClones</a></span><span class="op">(</span><span class="va">pbmc</span>, clonecall <span class="op">=</span> <span class="st">"aa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $CASLSGSARQLTF_CASSPTVAGEQFF</span></span>
<span><span class="co">#&gt; [1] 5 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CVVSDFGNEKLTF_CASSLGSGGTGNEQFF</span></span>
<span><span class="co">#&gt; [1] 3 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CVVSDNTGGFKTIF_CASSVRRERANTGELFF</span></span>
<span><span class="co">#&gt; [1] 3 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`CAVGEKGYGGSQGNLIF_CASSFRPPGSPLHF;CASHGARGDGFCEKLFF`</span></span>
<span><span class="co">#&gt; [1] 3 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CARKVRDSSYKLIF_CASSDSGYNEQFF</span></span>
<span><span class="co">#&gt; [1] 3 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CASLSGSARQLTF_CASSSTVAGEQYF</span></span>
<span><span class="co">#&gt; [1] 4 5</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizing-shared-clonotypes-on-an-apackoftheclones-plot">Visualizing Shared Clonotypes on an APackOfTheClones Plot<a class="anchor" aria-label="anchor" href="#visualizing-shared-clonotypes-on-an-apackoftheclones-plot"></a>
</h2>
<p>Using the output from <code><a href="../reference/getSharedClones.html">getSharedClones()</a></code>,
<code><a href="../reference/vizAPOTC.html">vizAPOTC()</a></code> and <code><a href="../reference/APOTCPlot.html">APOTCPlot()</a></code> both currently have
the exact same arguments to take the information and visually overlay
line links between each shared clone. Note that many more changes are to
come to this functionality. The arguments are as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>show_shared <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>only_link <span class="ot">=</span> <span class="cn">NULL</span>,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>clone_link_width <span class="ot">=</span> <span class="st">"auto"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>clone_link_color <span class="ot">=</span> <span class="st">"black"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>clone_link_alpha <span class="ot">=</span> <span class="fl">0.5</span></span></code></pre></div>
<p>Where if the output of <code>getSharedClones</code> is inputted into
<code>show_shared</code>, the links will be overlaid. The
<code>only_link</code> argument will further filter the links so that
all links originate from the cluster <code>only_link</code>. The other
are aesthetic arguments for the lines and are self explanatory. More
details in the function level docs.</p>
<p>Here is an example, using <code>pbmc</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get shared amino acid shared clones:</span></span>
<span><span class="va">shared_clones_aa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSharedClones.html">getSharedClones</a></span><span class="op">(</span><span class="va">pbmc</span>, clonecall <span class="op">=</span> <span class="st">"aa"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate the plot</span></span>
<span><span class="fu"><a href="../reference/vizAPOTC.html">vizAPOTC</a></span><span class="op">(</span></span>
<span>    <span class="va">pbmc</span>,</span>
<span>    clonecall <span class="op">=</span> <span class="st">"aa"</span>,</span>
<span>    show_shared <span class="op">=</span> <span class="va">shared_clones_aa</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="APackOfTheClones-shared_files/figure-html/shared_clones_links-1.png" width="700"></p>
<p>A more useful visualization may be to overlay the links from one
cluster, and setting <code>clone_link_color</code> to
<code>"blend"</code> which will color each clone link according to the
average color of two clusters, for even more intuitiveness:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/vizAPOTC.html">vizAPOTC</a></span><span class="op">(</span></span>
<span>    <span class="va">pbmc</span>,</span>
<span>    clonecall <span class="op">=</span> <span class="st">"aa"</span>,</span>
<span>    show_shared <span class="op">=</span> <span class="va">shared_clones_aa</span>,</span>
<span>    only_link <span class="op">=</span> <span class="fl">3</span>, <span class="co"># only link clonotypes from cluster 3</span></span>
<span>    clone_link_color <span class="op">=</span> <span class="st">"blend"</span>,</span>
<span>    clone_link_width <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    clone_link_alpha <span class="op">=</span> <span class="fl">0.9</span>,</span>
<span>    show_labels <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="APackOfTheClones-shared_files/figure-html/shared_clones_links_from_1_blend-1.png" width="700"></p>
<div class="section level3">
<h3 id="synergy-with-showclonehighlight">Synergy with <code>showCloneHighlight()</code><a class="anchor" aria-label="anchor" href="#synergy-with-showclonehighlight"></a>
</h3>
<p>In the interest of inspecting the topmost expanded clonotypes, the
topmost clones can be obtained, and the plot of clonal links can have
its shared clones highlighted with a different palette than the default
ggplot hues, and the non-highlighted sequences can even be slightly
dimmed to emphasize the difference. The following is an example of
highlighting and linking the top 4 most expanded clonotypes in
<code>pbmc</code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For convenience, do an APackOfTheClones Run first</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span><span class="va">pbmc</span>, clonecall <span class="op">=</span> <span class="st">"aa"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get shared amino acid shared clones for the last run -</span></span>
<span><span class="co"># note that the run_id can be replaced with `clonecall = "aa"`</span></span>
<span><span class="va">shared_clones_aa_top4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getSharedClones.html">getSharedClones</a></span><span class="op">(</span></span>
<span>  <span class="va">pbmc</span>,</span>
<span>  run_id <span class="op">=</span> <span class="fu"><a href="../reference/getLastApotcDataId.html">getLastApotcDataId</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>,</span>
<span>  top <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate the unhighlighted plot</span></span>
<span><span class="va">linked_apotc_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/APOTCPlot.html">APOTCPlot</a></span><span class="op">(</span></span>
<span>    <span class="va">pbmc</span>,</span>
<span>    show_shared <span class="op">=</span> <span class="va">shared_clones_aa_top4</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># highlight the top 4 clones with the viridis palette</span></span>
<span><span class="co"># also slightly dimming other clones</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/showCloneHighlight.html">showCloneHighlight</a></span><span class="op">(</span></span>
<span>    <span class="va">linked_apotc_plot</span>,</span>
<span>    clonotype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">shared_clones_aa_top4</span><span class="op">)</span>,</span>
<span>    color_each <span class="op">=</span> <span class="fu">viridis</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>    default_color <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    scale_bg <span class="op">=</span> <span class="fl">0.95</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; * using the latest APackOfTheClones Run Data with object id: umap;CTaa;_;_</span></span></code></pre>
<p><img src="APackOfTheClones-shared_files/figure-html/shared_clones_links_highlight-1.png" width="700"></p>
<p>Note that to actually get the frequencies of those top clones, one
can use the <code>countCloneSizes</code> function.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Qile Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
