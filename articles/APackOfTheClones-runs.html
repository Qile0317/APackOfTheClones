<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="APackOfTheClones">
<title>Storing and Fine-Tuning APackOfTheClones Runs • APackOfTheClones</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Storing and Fine-Tuning APackOfTheClones Runs">
<meta property="og:description" content="APackOfTheClones">
<meta property="og:image" content="https://qile0317.github.io/APackOfTheClones/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=%7BG-TSDH5XEN3S%7D"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '{G-TSDH5XEN3S}');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">APackOfTheClones</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/APackOfTheClones.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/APackOfTheClones-runs.html">Storing and Fine-Tuning APackOfTheClones Runs</a>
    <a class="dropdown-item" href="../articles/archive/v0-main.html">ARCHIVED: A walkthrough of APackOfTheClones v0.1.x</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/Qile0317/APackOfTheClones/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Storing and Fine-Tuning APackOfTheClones Runs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Qile0317/APackOfTheClones/blob/HEAD/vignettes/APackOfTheClones-runs.Rmd" class="external-link"><code>vignettes/APackOfTheClones-runs.Rmd</code></a></small>
      <div class="d-none name"><code>APackOfTheClones-runs.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>As demonstrated in <code><a href="../articles/APackOfTheClones.html">vignette("APackOfTheClones")</a></code>, after
processing the seurat &amp; clonotype data properly with
<code>scRepertoire</code>, <code>vizAPOTC</code> provides a direct way
to produce the ball-packing clonal expansion visualization, though for
select users it may be somewhat clunky, if certain parameters need to be
readjusted constantly. In this vignette, more details about how
APackOfTheClones runs can be stored and re-adjusted will be covered -
mainly through <code>RunAPOTC</code>, <code>APOTCPlot</code>, and
<code>AdjustAPOTC</code>. Ensure to read the aforementioned vignette
before this one.</p>
<details><summary><strong>As a reminder, here’s how to set up the seurat object and
clonotype data</strong>
</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">scRepertoire</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># A seurat object named `pbmc` is loaded with a corresponding `contig_list`</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu">scRepertoire</span><span class="fu">::</span><span class="fu">combineExpression</span><span class="op">(</span></span>
<span>  <span class="fu">scRepertoire</span><span class="fu">::</span><span class="fu">combineTCR</span><span class="op">(</span></span>
<span>    <span class="va">contig_list</span>,</span>
<span>    samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P17B"</span>, <span class="st">"P17L"</span>, <span class="st">"P18B"</span>, <span class="st">"P18L"</span>, <span class="st">"P19B"</span>, <span class="st">"P19L"</span>, <span class="st">"P20B"</span>, <span class="st">"P20L"</span><span class="op">)</span>,</span>
<span>    removeNA <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    removeMulti <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    filterMulti <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="va">pbmc</span>,</span>
<span>  cloneCall <span class="op">=</span> <span class="st">"gene"</span>,</span>
<span>  proportion <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 2000 features across 500 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (2000 features, 2000 variable features)</span></span>
<span><span class="co">#&gt;  2 layers present: counts, data</span></span>
<span><span class="co">#&gt;  1 dimensional reduction calculated: umap</span></span></code></pre></div>
</details><div class="section level3">
<h3 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h3>
<p>All of <code>vizAPOTC</code>’s arguments are actually derived from
<code>RunAPOTC</code> and <code>APOTCPlot</code>. The former is
responsible for storing data of the S4 class <code>ApotcData</code> in
the seurat object under a named list in
<code>@misc$APackOfTheClones</code> under some character run ID, and the
latter allows the visualization of these data objects with some
customization. <code>AdjustAPOTC</code> has many arguments for adjusting
the data associated with some APackOfTheClones run stored by
<code>RunAPOTC</code>, including adjusting cluster positions, colors,
repulsion, etc. which can be visualized again with
<code>APOTCPlot</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="managing-apackoftheclones-run-data">Managing APackOfTheClones run data<a class="anchor" aria-label="anchor" href="#managing-apackoftheclones-run-data"></a>
</h2>
<p><code>RunAPOTC</code> has approximate the first half of
<code>vizAPOTC</code>’s arguments until <code>max_repulsion_iter</code>,
meaning it has all the data subsetting, circle size scaling, and cluster
repulsion capabilities covered in the previous vignette. The most
essential difference is the presence of the argument
<code>run_id</code>, which corresponds to an id for the
<code>ApotcData</code> object. If left blank, one will be automatically
generated in the following format:</p>
<blockquote>
<p><code>reduction_base;clonecall;keyword_arguments;extra_filter</code></p>
</blockquote>
<p>where if keyword arguments and extra_filter are underscore
(<code>_</code>) characters if there was no input for the
<code>...</code> and <code>extra_filter</code> parameters.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here is the function ran with its default parameters</span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#&gt; Initializing APOTC run...</span></span>
<span><span class="co">#&gt; * Setting `clone_scale_factor` to 0.3</span></span>
<span><span class="co">#&gt; * id for this run: umap;CTstrict;_;_</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Packing clones into clusters</span></span>
<span><span class="co">#&gt; [==================================================] 100%</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; repulsing all clusters | max iterations = 20</span></span>
<span><span class="co">#&gt; [==================================================] 100%</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Completed successfully, time elapsed: 0.155 seconds</span></span>
<span><span class="co">#&gt;</span></span></code></pre></div>
<p>From the verbal queues, one can see how the <code>run_id</code> was
set. Here’s it ran again but with more optional arguments and a custom
<code>run_id</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span></span>
<span>    <span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"sample17"</span>, orig.ident <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P17B"</span>, <span class="st">"P17L"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="utilities-for-managing-apackoftheclones-runs">Utilities for Managing APackOfTheClones Runs<a class="anchor" aria-label="anchor" href="#utilities-for-managing-apackoftheclones-runs"></a>
</h3>
<p>It is to note that the data abstraction here with a
<code>run_id</code> is intentional, and users should not manually touch
any of the <code>ApotcData</code> objects with the seurat object unless
they are extremely familiar with the latest internal implementation.
Instead, here is a collection of functions that may be useful:</p>
<ul>
<li>
<code>getApotcDataIds(pbmc)</code> gets all current
<code>run_id</code>’s, if any.</li>
<li>
<code>getLastApotcDataId(pbmc)</code> gets the latest
<code>run_id</code>, if any.</li>
<li>
<code>containsApotcRun(pbmc, run_id = "foo")</code> returns whether
a <code>run_id</code> exists in the seurat object.</li>
<li>
<code>deleteApotcData(pbmc, run_id = "foo")</code> deletes <em>all
data</em> associated with a certain <code>run_id</code>.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="apotcplot">APOTCPlot<a class="anchor" aria-label="anchor" href="#apotcplot"></a>
</h2>
<p>To visualize stored APackOfTheClones runs, <code>APOTCPlot</code>
takes in a seurat object and the <code>run_id</code>. If no
<code>run_id</code> is provided, it defaults to using the latest run.
All other parameters are same as in the second half of
<code>vizAPOTC</code>. Although it is noteworthy that if the user had
always relied on auto-generated <code>run_id</code>’s then
<code>APOTCPlot</code> also has these subsetting arguments:</p>
<p>And putting in identical arguments to generate the original
<code>ApotcData</code> would work too, but this approach is less
recommended as its a lot more (unnecessarily) verbose. Here is
<code>APOTCPlot</code> in action:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Here, plots for samples 17, 18, and 19 as seen in the previous vignette are made, where</span></span>
<span><span class="co"># `orig.ident` is a custom column in the example data with levels corresponding to sample ids:</span></span>
<span><span class="co"># ("P17B" "P17L" "P18B" "P18L" "P19B" "P19L" "P20B" "P20L"). </span></span>
<span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span></span>
<span>  <span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"P17"</span>, orig.ident <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P17B"</span>, <span class="st">"P17L"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span></span>
<span>  <span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"P18"</span>, orig.ident <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P18B"</span>, <span class="st">"P18L"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">pbmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RunAPOTC.html">RunAPOTC</a></span><span class="op">(</span></span>
<span>  <span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"P19"</span>, orig.ident <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P19B"</span>, <span class="st">"P19L"</span><span class="op">)</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/vizAPOTC.html">vizAPOTC</a></span><span class="op">(</span><span class="va">pbmc</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/APOTCPlot.html">APOTCPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"P17"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/APOTCPlot.html">APOTCPlot</a></span><span class="op">(</span><span class="va">pbmc</span>, run_id <span class="op">=</span> <span class="st">"P18"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/APOTCPlot.html">APOTCPlot</a></span><span class="op">(</span><span class="va">pbmc</span><span class="op">)</span>, <span class="co"># run_id omitted as sample 19 was the latest run</span></span>
<span>  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"17"</span>, <span class="st">"18"</span>, <span class="st">"19"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; * using the latest APackOfTheClones Run Data with object id: P19</span></span></code></pre></div>
<p><img src="APackOfTheClones-runs_files/figure-html/apotcplot-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="adjustapotc">AdjustAPOTC<a class="anchor" aria-label="anchor" href="#adjustapotc"></a>
</h2>
<p>This function’s parameters help modify certain attributes about
APackOfTheClones runs, and has the exact same first six parameters as
<code>APOTCPlot</code> for managing which run to modify. It also
possesses the same four repulsion arguments in <code>vizAPOTC</code> and
<code>RunAPOTC</code> if a run is to be repulsed again. See the function
level documentation for the following parameters that can modify cluster
locations, colors, and the adjustment of the
<code>clone_scale_factor</code> and <code>rad_scale_factor</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Qile Yang.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
